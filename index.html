<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Riesgo Cl√≠nico: Regresi√≥n Log√≠stica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        :root {
            --primary-bg: #f8fafc;
            --vibrant-cyan: #00e5ff; 
        }

        body {
            background-color: var(--primary-bg);
            color: #0f172a;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 250px;
        }
        @media (min-width: 768px) {
            .chart-wrapper { height: 300px; }
        }

        .bar-chart-wrapper {
            position: relative;
            width: 100%;
            height: 180px;
        }

        .logo-cyan {
            color: var(--vibrant-cyan);
            text-shadow: 0 0 12px rgba(0, 229, 255, 0.4);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 1);
        }

        input[type=range] {
            height: 8px;
            -webkit-appearance: none;
            background: #e2e8f0;
            border-radius: 5px;
            width: 100%;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: var(--vibrant-cyan);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
            border: 3px solid white;
        }

        .metric-badge {
            font-size: 0.7rem;
            font-weight: 800;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50 border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3 md:space-x-4">
                <div class="flex flex-col leading-none border-r-2 border-slate-200 pr-3 md:pr-4 mr-1 md:mr-2">
                    <span class="text-lg md:text-2xl font-black logo-cyan tracking-tighter uppercase italic">Dataflow IA</span>
                    <span class="text-[8px] md:text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]">Health Intelligence</span>
                </div>
                <div>
                    <h1 class="text-xs font-bold text-slate-900 leading-tight md:text-lg">Monitor de Riesgo</h1>
                    <p class="hidden sm:block text-[10px] text-slate-500 uppercase tracking-widest font-semibold">C√°lculo de Hemodin√°mica Avanzada</p>
                </div>
            </div>
            <div class="flex items-center space-x-2 md:space-x-4">
                <div class="hidden md:block text-right border-r border-slate-200 pr-4">
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">Motor Inferencia</p>
                    <p class="text-xs font-bold text-cyan-500">v3.0 - Full Dynamic Response</p>
                </div>
                <button class="bg-slate-900 text-white text-[9px] md:text-[10px] font-bold py-2 px-3 md:px-4 rounded-lg hover:bg-slate-800 transition-all uppercase tracking-wider">Protocolos</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8 space-y-6 md:space-y-8">
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8">
            
            <!-- Simulador de Par√°metros -->
            <div class="lg:col-span-5 space-y-6">
                <section class="glass-card p-6 md:p-8 rounded-[1.5rem] md:rounded-[2rem] shadow-xl border-t-8 border-cyan-400 relative overflow-hidden h-full">
                    <h2 class="text-lg md:text-xl font-black text-slate-800 mb-6 md:mb-8 flex items-center uppercase tracking-tight">
                        <span class="mr-3 p-2 bg-cyan-50 rounded-lg">ü©∫</span> Par√°metros Cl√≠nicos
                    </h2>
                    
                    <div class="space-y-5 md:space-y-6">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2">Frec. Card√≠aca</label>
                                <div class="flex items-end justify-between">
                                    <span id="fcValue" class="text-2xl font-black text-slate-900 leading-none">80</span>
                                    <span class="text-[10px] font-bold text-slate-400 ml-1 uppercase">BPM</span>
                                </div>
                                <input type="range" id="fcInput" min="40" max="180" value="80" class="mt-4">
                            </div>
                            <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2">Saturaci√≥n</label>
                                <div class="flex items-end justify-between">
                                    <span id="spo2Value" class="text-2xl font-black text-slate-900 leading-none">98%</span>
                                    <span class="text-[10px] font-bold text-slate-400 ml-1 uppercase">SpO2</span>
                                </div>
                                <input type="range" id="spo2Input" min="70" max="100" value="98" class="mt-4">
                            </div>
                        </div>

                        <div class="p-4 md:p-5 bg-cyan-50/30 rounded-2xl border border-cyan-100">
                            <h3 class="text-[10px] font-black text-cyan-600 uppercase tracking-widest mb-4 flex items-center">
                                <span class="mr-2">‚ö°</span> Presi√≥n Arterial (mmHg)
                            </h3>
                            <div class="space-y-6">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <label class="text-[11px] font-bold text-slate-600 uppercase">Sist√≥lica</label>
                                        <span id="sisValue" class="text-sm font-black text-slate-900">120</span>
                                    </div>
                                    <input type="range" id="sisInput" min="60" max="220" value="120">
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <label class="text-[11px] font-bold text-slate-600 uppercase">Diast√≥lica</label>
                                        <span id="diaValue" class="text-sm font-black text-slate-900">80</span>
                                    </div>
                                    <input type="range" id="diaInput" min="30" max="140" value="80">
                                </div>
                            </div>
                        </div>

                        <div class="pt-6 md:pt-8 text-center bg-white rounded-3xl p-6 shadow-inner border border-slate-50">
                            <p class="text-[10px] text-slate-400 font-black uppercase mb-1 tracking-[0.2em]">Probabilidad de Evento</p>
                            <div id="probDisplay" class="text-5xl md:text-6xl font-black text-slate-900 tracking-tighter mb-2">2.4%</div>
                            <div id="riskLevel" class="metric-badge bg-green-100 text-green-600 italic">Compensado</div>
                            <div class="mt-4 flex justify-center space-x-3 md:space-x-4 text-[9px] font-bold text-slate-400 uppercase">
                                <span>PAM: <span id="pamValue" class="text-slate-700">93</span></span>
                                <span>Shock Ind: <span id="shockValue" class="text-slate-700">0.66</span></span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Gr√°ficos y Dashboards -->
            <div class="lg:col-span-7 space-y-6">
                <!-- Gr√°fico de Curva Principal -->
                <section class="bg-white p-4 md:p-6 rounded-[1.5rem] md:rounded-[2rem] shadow-sm border border-slate-100">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                        <h2 class="text-base md:text-lg font-black text-slate-900 uppercase tracking-tighter italic">Din√°mica de Probabilidad</h2>
                        <div class="flex items-center text-[10px] font-bold text-slate-400 space-x-4 mt-2 sm:mt-0">
                            <span class="flex items-center"><span class="w-2 h-2 bg-cyan-400 rounded-full mr-1"></span> Modelo</span>
                            <span class="flex items-center"><span class="w-2 h-2 bg-red-400 rounded-full mr-1"></span> Actual</span>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="logisticCurveChart"></canvas>
                    </div>
                </section>

                <!-- Grid Inferior: Precisi√≥n y Pesos -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Panel de Precisi√≥n DIN√ÅMICO -->
                    <div class="bg-slate-900 text-white p-6 rounded-[1.5rem] md:rounded-[2rem] shadow-xl flex flex-col justify-between">
                        <div>
                            <h3 class="text-xs font-bold uppercase tracking-widest text-cyan-400 mb-6 italic">Confianza del Diagn√≥stico</h3>
                            <div class="space-y-6">
                                <div class="space-y-2">
                                    <div class="flex justify-between text-[10px] font-black uppercase tracking-wider">
                                        <span class="text-slate-400">Certidumbre Cl√≠nica</span>
                                        <span id="accuracyLabel" class="text-cyan-400">96%</span>
                                    </div>
                                    <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                                        <div id="accuracyBar" class="bg-cyan-400 h-full w-[96%] transition-all duration-500 shadow-[0_0_10px_rgba(0,229,255,0.4)]"></div>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-[10px] font-black uppercase tracking-wider">
                                        <span class="text-slate-400">Inconsistencia</span>
                                        <span id="errorLabel" class="text-slate-300">2.1%</span>
                                    </div>
                                    <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                                        <div id="errorBar" class="bg-slate-600 h-full w-[15%] transition-all duration-500"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 pt-4 border-t border-slate-800 flex items-center justify-between">
                            <span class="text-[9px] font-bold text-slate-500 uppercase tracking-widest italic">An√°lisis en Tiempo Real</span>
                            <span id="statusBadge" class="bg-cyan-400/10 text-cyan-400 text-[8px] font-black px-2 py-1 rounded border border-cyan-400/20">ESTABLE</span>
                        </div>
                    </div>

                    <!-- Gr√°fico de Pesos DIN√ÅMICO -->
                    <div class="bg-white p-6 rounded-[1.5rem] md:rounded-[2rem] shadow-sm border border-slate-100 flex flex-col">
                        <h3 class="text-xs font-black text-slate-800 mb-4 uppercase italic">Ponderaci√≥n Variable (Œ≤)</h3>
                        <p class="text-[9px] text-slate-400 mb-2 uppercase font-bold tracking-tighter">Impacto de cada s√≠ntoma en el riesgo</p>
                        <div class="bar-chart-wrapper flex-grow">
                            <canvas id="weightsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-slate-900 text-slate-400 py-12 mt-12 border-t border-slate-800">
        <div class="max-w-7xl mx-auto px-4 flex flex-col items-center md:flex-row md:justify-between">
            <div class="text-center md:text-center">
                <div class="logo-cyan font-black text-2xl italic tracking-tighter mb-1 uppercase">Dataflow IA</div>
                <p class="text-[9px] font-bold text-slate-600 uppercase tracking-[0.4em]Health Intelligence Engine</p>
            </div>
            <div class="mt-8 md:mt-0 text-center md:text-right">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">&copy; 2026 ¬∑ www.dataflowia.com / contacto@dataflowia.com / RCH</p>
            </div>
        </div>
    </footer>

    <script>
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#94a3b8';

        const inputs = ['fcInput', 'spo2Input', 'sisInput', 'diaInput'];
        const displays = {
            fc: document.getElementById('fcValue'),
            spo2: document.getElementById('spo2Value'),
            sis: document.getElementById('sisValue'),
            dia: document.getElementById('diaValue'),
            pam: document.getElementById('pamValue'),
            shock: document.getElementById('shockValue'),
            prob: document.getElementById('probDisplay'),
            level: document.getElementById('riskLevel'),
            accBar: document.getElementById('accuracyBar'),
            accLabel: document.getElementById('accuracyLabel'),
            errBar: document.getElementById('errorBar'),
            errLabel: document.getElementById('errorLabel'),
            status: document.getElementById('statusBadge')
        };

        let logisticChart, weightsChart;

        function initCharts() {
            const ctxL = document.getElementById('logisticCurveChart').getContext('2d');
            logisticChart = new Chart(ctxL, {
                type: 'line',
                data: {
                    labels: Array.from({length: 41}, (_, i) => i * 2.5),
                    datasets: [
                        {
                            data: Array.from({length: 41}, (_, i) => 1 / (1 + Math.exp(-0.2 * (i - 20)))),
                            borderColor: '#00e5ff',
                            borderWidth: 3,
                            pointRadius: 0,
                            fill: true,
                            backgroundColor: 'rgba(0, 229, 255, 0.05)',
                            tension: 0.4
                        },
                        {
                            data: [],
                            borderColor: '#ef4444',
                            pointBackgroundColor: '#ef4444',
                            pointRadius: 8,
                            showLine: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 1, ticks: { callback: v => (v * 100) + '%' }, grid: { color: '#f1f5f9' } },
                        x: { display: true, ticks: { display: false }, grid: { display: false } }
                    }
                }
            });

            const ctxW = document.getElementById('weightsChart').getContext('2d');
            weightsChart = new Chart(ctxW, {
                type: 'bar',
                data: {
                    labels: ['FC (Taqui)', 'SpO2 (Hipox)', 'PAM (Hipot)', 'Shock'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#f59e0b', '#06b6d4', '#3b82f6', '#ef4444'],
                        borderRadius: 6,
                        barThickness: 15
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { min: 0, max: 10, grid: { color: '#f1f5f9' }, ticks: { font: { size: 9 } } },
                        y: { grid: { display: false }, ticks: { font: { weight: 'bold', size: 10 } } }
                    }
                }
            });
        }

        function updateSimulation() {
            const fc = parseInt(document.getElementById('fcInput').value);
            const spo2 = parseInt(document.getElementById('spo2Input').value);
            const sis = parseInt(document.getElementById('sisInput').value);
            const dia = parseInt(document.getElementById('diaInput').value);

            const pam = Math.round(dia + (sis - dia) / 3);
            const shockIndex = (fc / sis).toFixed(2);

            // Actualizar textos
            displays.fc.innerText = fc;
            displays.spo2.innerText = spo2 + '%';
            displays.sis.innerText = sis;
            displays.dia.innerText = dia;
            displays.pam.innerText = pam;
            displays.shock.innerText = shockIndex;

            // L√≥gica Matem√°tica de Regresi√≥n Log√≠stica
            const bFC = 0.08 * (fc - 80);
            const bSpO2 = -0.5 * (spo2 - 95);
            const bPAM = pam < 65 ? -0.3 * (pam - 65) : 0;
            const bShock = shockIndex > 0.8 ? 6 * (shockIndex - 0.8) : 0;

            const logit = -4.5 + bFC + bSpO2 + bPAM + bShock;
            const prob = 1 / (1 + Math.exp(-logit));
            const probPct = (prob * 100).toFixed(1);

            displays.prob.innerText = probPct + '%';

            // Actualizar Gr√°fico de Pesos (Impacto Individual)
            // Usamos valores absolutos para mostrar "fuerza" de cada s√≠ntoma
            weightsChart.data.datasets[0].data = [
                Math.max(0, bFC).toFixed(2),
                Math.max(0, bSpO2).toFixed(2),
                Math.max(0, bPAM).toFixed(2),
                Math.max(0, bShock).toFixed(2)
            ];
            weightsChart.update('none');

            // Actualizar Indicadores de Confianza
            // Si el riesgo es muy alto o hay datos muy contradictorios, la certidumbre baja
            let certainty = 98 - (prob * 20); 
            if (fc > 150 && spo2 < 80) certainty -= 15; // Datos extremos confunden al motor
            
            certainty = Math.max(45, certainty).toFixed(1);
            displays.accLabel.innerText = certainty + '%';
            displays.accBar.style.width = certainty + '%';
            
            const inconsistency = (100 - certainty).toFixed(1);
            displays.errLabel.innerText = inconsistency + '%';
            displays.errBar.style.width = inconsistency + '%';

            // Status Badge
            if (prob > 0.8) {
                displays.status.innerText = "CR√çTICO";
                displays.status.className = "bg-red-500/10 text-red-500 text-[8px] font-black px-2 py-1 rounded border border-red-500/20";
                displays.level.className = 'metric-badge bg-red-100 text-red-600 italic';
                displays.level.innerText = 'SHOCK INMINENTE';
                displays.prob.className = 'text-5xl md:text-6xl font-black text-red-600 tracking-tighter mb-2';
            } else if (prob > 0.4) {
                displays.status.innerText = "ALERTA";
                displays.status.className = "bg-amber-500/10 text-amber-500 text-[8px] font-black px-2 py-1 rounded border border-amber-500/20";
                displays.level.className = 'metric-badge bg-amber-100 text-amber-600 italic';
                displays.level.innerText = 'PRE-SHOCK / DESCOMPENSADO';
                displays.prob.className = 'text-5xl md:text-6xl font-black text-slate-900 tracking-tighter mb-2';
            } else {
                displays.status.innerText = "ESTABLE";
                displays.status.className = "bg-cyan-400/10 text-cyan-400 text-[8px] font-black px-2 py-1 rounded border border-cyan-400/20";
                displays.level.className = 'metric-badge bg-green-100 text-green-600 italic';
                displays.level.innerText = 'COMPENSADO';
                displays.prob.className = 'text-5xl md:text-6xl font-black text-slate-900 tracking-tighter mb-2';
            }

            // Mover punto en la curva principal
            const graphX = Math.min(Math.max((logit + 4.5) * 5 + 50, 0), 100);
            logisticChart.data.datasets[1].data = [{x: graphX, y: prob}];
            logisticChart.update('none');
        }

        inputs.forEach(id => document.getElementById(id).addEventListener('input', updateSimulation));
        window.onload = () => { initCharts(); updateSimulation(); };
    </script>
</body>

</html>
